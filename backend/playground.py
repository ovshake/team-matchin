import os
import openai
from bs4 import BeautifulSoup

openai.api_key = os.getenv("OPENAI_API_KEY")

start_sequence = "\nAI:"
restart_sequence = "\nHuman:"



def get_gpt3_response(prompt_text):
    response = openai.Completion.create(
        model="text-davinci-003",
        prompt=f"Following are some profiles from Linkedin:\nProfile 1\nName: Mohak Shroff \nProfession: Senior Vice President of Engineering\nWork Description: I lead engineering, operations, IT, and security @ LinkedIn - the teams responsible for building, scaling, and protecting LinkedIn.! \nHis Feed: \nPost 1: I love the way Chicago bulls won that match. Nail Biting! \nPost 2:  I am hiring for the following roles, Software Development Enginner, Applied Research Engineer and Machine Learning Manager\nProfile 2\nName: Tomer Cohen \nProfession: Chief Product Officer at LinkedIn\nWork Description: As the global head of product, I am responsible for setting and executing the global product strategy at LinkedIn. I oversee all teams responsible for product management, user experience and design, editorial, business development, content creation and customer operations. Our vision is to create economic opportunity for every member of the global workforce.\nHis Feed: \nPost 1: Product market fit is so important in current macroeconomic climate.\nComment 1: sorry Mark, We are not hiring currently.\nProfile 3\nName: Ashutosh Gupta\nProfession: Country Manager, LinkedIn India\nWork Description: Experienced Senior Sales leader with a demonstrated history of working in the internet industry. Skilled in Sales, Customer Relationship Management (CRM), Management, Account Management, and Pre-sales. Strong professional with a PGDM focused in Finance & Marketing from Indian Institute of Management, Lucknow.  \nHis Feed: \nPost 1: India is a rocket ship waiting to happen! \nPost 2: Sales is hard! Unless you do it the right way.\n\nFollowing are some courses on Linkedin:\nCourse 1\nName: Excel for Business Analysts\nDescription: Business analytics is one of today’s fastest growing careers, but it's also an area where companies face a shortage of talent. In this course, Professor Michael McDonald walks you through everything you need to know to start implementing business analytics skills and concepts. Michael begins with the basics, explaining what you should know about business analytics, including definitions and uses. He demonstrates how to get started in business analytics, including accessing and integrating the correct data and constructing a data map. Michael shows how to use predictive tools in business analytics that can equip firms to make better decisions. Finally, Michael covers how business analytics can provide significant guidance for management in developing a strategy and understanding the market. \nCourse 2\nName: Practice It: Python Data Structures\nDescription: Are you looking to brush up on your Python skills? Maybe you’ve learned some Python basics and want to take your skills further? This course with Kaylee Kohfeldt provides some hands-on, practical training on Python concepts like sets, collections, string formatting, and lambda functions. Kayle covers skills that you may not use in your day-to-day programming—like a counter, palindrome checker, cleaning up duplicate data, and more—that can help you expand your Python knowledge. If you’re looking to take your Python skills to the next level so you can write more readable and efficient code, join Kaylee in this course. This course is integrated with GitHub Codespaces, an instant cloud developer environment that offers all the functionality of your favorite IDE without the need for any local machine setup. With Codespaces, you can get hands-on practice from any machine, at any time—all while using a tool that you’ll likely encounter in the workplace. Check out the “Using GitHub Codespaces with this course” video to learn how to get started.\n\nFollowing are some groups on Linkedin: \nGroup 1\nName: Machine Learning Institute Certificate (MLI) Forum\nDescription: The Machine Learning Institute Certificate in Finance (MLI) http://mlinstitute.org/. Quantitative finance is moving into a new era. Traditional quant skills are no longer adequate to deal with the latest challenges in finance. The Machine Learning Institute Certificate offers candidates the chance to upgrade their skill set by combining academic rigour with practical industry insight. The Machine Learning Institute Certificate in Finance (MLI) is a comprehensive six-month part-time course, with weekly live lectures in London or globally online. The MLI is comprised of 2 levels, 6 modules, 25 lecture weeks, assignments, a practical final project and a final exam which can be taken from any global location online using our live invigilation platform. This course has been designed to empower individuals who work in or are seeking a career in machine learning in finance. Throughout our unique MLI programme, candidates work with hands-on assignments designed to illustrate the algorithms studied and to experience first-hand the practical challenges involved in the design and successful implementation of machine learning models. The MLI is a career-enhancing professional qualification, that can be taken worldwide.\nGroup 2\nName: Quant Trading\nDescription: (Related Keywords: Research, Trader, Trading, Quant Trading, Quant Trader, Quantitative Trading, Quant Developer, Trading Strategist, Short Term Trading, Vol Arb, Volatility Arbitrage, Arbitrage, Electronic Trading, Electronic Trader, Systematic Trader, Systematic, Quantitative, Quant, Trading systems, Quantitative Researcher, Portfolio Mean Reversion, Momentum, Artificial Intelligence, Manager, Statarb, Stat-Arb, Statistical Arbitrage, Stocks, Systematic, DMM, AMM, Derivatives, Futures, Spreads, Arbitrage trading, Automated Trading, Algorithmic Trading, trading strategies, Market Making, Blackbox, Greybox, Tick Data, Systematic Trading, Quantitative Trading, Financial Research, prop strategies, electronically traded, Financial Engineering, Financial engineer, non-linear, alpha signals, alpha, Smart execution, intraday, HFT, High Frequency, High Frequency Trading, Real Time, Order Book, Modeling,  VWAP, Twap, Algo Trading, Algorithmic Trader, Low Latency Trading, Low Latency, Prop Trading, Option Trading, Electronic Trading, Dark Pool, Robotic, Probability, Automated, Automated Market Making, Liquidity Provision, Market Microstructure, Medium Frequency Trading, CTA, Relative Value, Trend Following, Managed Futures, Quantitative Research, Multifactor, Portfolio Optimisation, portfolio construction, Market Impact, Global tactical Asset Allocation, CUDA, KDB, R, S+, Python,  Matlab, Cuda, C++, C#, Java, Scala, Data Mining, Statistical Computing, Machine Learning, Financial Engineering, Backtesting, Econometrics, Economics, Computer Science, Engineering, Statistics, Optimisation,  Natural Language Processing, Time Series, Stock Selection, Smart Order Routing, Back Testing, Simulation, Data Analysis, asset allocation, model calibration, Volatility Trading, Computational Finance, Garch, high dimensional data, PCA, Principle Component Analysis, Financial Maths, SVM, Support Vector Machine, Regression)\nNow following is a chat based on the above information.\nThe AI answer has 2 parts, first is what the AI refers to, like:\n<PEOPLE> to refer to people\n<COURSE> to refer to course \n<GROUP> to refer to groups\nSecond part is enclosed under <RESP>, which is a human-like response that the AI gives. \nIt should have both the parts. \nHuman: What are some courses I should use to keep myself upskilled? \nAI: <COURSE>Python Data Structures, Python Data Structures</COURSE><RESP>These are some of the courses, which may be useful for you to upskill yourself, Keep on Learn[In]!</RESP>\nHuman: Do you know anyone who is hiring for software engineers? \nAI: <PEOPLE>Mohak Shroff</PEOPLE><RESP>These are the following people who are currently hiring as per their posts</RESP>\nHuman: Which groups should I join to learn Quant trading?\nAI: <GROUP>Quant Trading</GROUP><RESP>These are the groups which you should join to hone your skills</RESP>\nHuman: Is Tomer hiring currently?\nAI: <PEOPLE>Tomer Cohen</PEOPLE><RESP>No, Tomer is not currently hiring as per his post. </RESP>\nHuman: I'm looking for people to reach out in the Machine Learning domain. Whom should I reach out to?\nAI: <PEOPLE>Mohak Shroff</PEOPLE><RESP>You can reach you to Mohak, he is Senior VP of Engineering at Linkedin and manages the teams  responsible for building, scaling, and protecting LinkedIn</RESP> \nHuman: I want to interact with people interested in Trading. Where should I go? \nAI: <GROUP>Quant Trading</GROUP><RESP>You can join the Quant Trading Group which has people who want to hone their trading skills</RESP> \nHuman: I just got laid off. I am looking for new jobs. Do you know anyone who is hiring for Machine Learning Research roles?\nAI: <PEOPLE>Mohak Shroff</PEOPLE><RESP>You can reach out to Mohak, he is currently hiring for senior applied research engineers.</RESP>\nHuman:Anything I should meanwhile I am looking for jobs?\nAI: <COURSE>Excel for Business Analysts</COURSE><RESP>You can take the Excel for Business Analysts course to brush up on your skills and make yourself more marketable. It's a comprehensive six-month part-time course with weekly live lectures and hands-on assignments.</RESP>\nHuman: {prompt_text}\nAI:",
        temperature=0.73,
        max_tokens=512,
        top_p=0.75,
        frequency_penalty=0,
        presence_penalty=0
    )
    output = response["choices"][0]["text"]
    print(f"Output: {output}")
    # extract html code from the text with tags <PEOPLE>, <COURSE>, <GROUP> and <RESP> using beautiful soup
    soup = BeautifulSoup(output, 'html.parser')
    # extract the text from the html code
    try:
        people = soup.find('people').text
    except:
        people = None
    try:
        course = soup.find('course').text
    except:
        course = None
    try:
        group = soup.find('group').text
    except:
        group = None
    try:
        resp = soup.find('resp').text
    except:
        resp = None
    # put it in a json format
    json_output = {
        "people": people ,
        "course": course ,
        "group": group ,
        "resp": resp
    }
    return json_output
